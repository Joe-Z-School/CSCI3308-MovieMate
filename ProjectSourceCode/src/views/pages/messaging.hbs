{{> nav}}

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
<link rel="stylesheet" href="../resources/css/messaging.css">
<script src="/socket.io/socket.io.js"></script>
<script src="../../resources/js/messagingScript.js" defer></script>
<script type="module" src="https://cdn.jsdelivr.net/npm/emoji-picker-element@^1/index.js"></script>

<pre>{{json allFriends}}</pre>


<div class="container-fluid">
<!-- Friends List Section -->
<div class="col-md-2 col-sm-12 friends-list">
  <h5>Friends List</h5>
  <div class="friends-list-content">
    <!-- Favorites -->
    <h6 class="px-3 mt-3">Favorites</h6>
    <ul class="list-group list-group-flush" id="favorites">
      {{#each favorites}}
      <li class="list-group-item friend d-flex align-items-center" data-user-id="{{this.id}}" data-user="{{this.name}}">
        <div class="position-relative me-2">
          <img src="{{this.profileIcon}}" class="rounded-circle" alt="Profile Icon" width="40" height="40">
          <i class="bi bi-star-fill text-warning position-absolute top-0 start-0" title="Favorite"></i>
        </div>
        <span class="ms-2">{{this.name}}</span>
        <div class="dropdown ms-auto">
          <button class="btn btn-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
            Actions
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">View Profile</a></li>
            <li><a class="dropdown-item" href="#">Remove from Favorites</a></li>
            <li><a class="dropdown-item text-danger" href="#">Block User</a></li>
          </ul>
        </div>
      </li>
      {{/each}}
    </ul>

    <!-- Unread Messages -->
    <h6 class="px-3 mt-3">Unread Messages</h6>
    <ul class="list-group list-group-flush" id="unread">
      {{#each unreadMessages}}
      <li class="list-group-item friend d-flex align-items-center" data-user-id="{{this.id}}" data-user="{{this.name}}">
        <div class="position-relative me-2">
          <img src="{{this.profileIcon}}" class="rounded-circle" alt="Profile Icon" width="40" height="40">
          <span class="badge bg-danger position-absolute top-0 end-0" title="Unread Messages"></span>
        </div>
        <span class="ms-2">{{this.name}}</span>
        <div class="dropdown ms-auto">
          <button class="btn btn-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
            Actions
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">View Profile</a></li>
            <li><a class="dropdown-item" href="#">Add to Favorites</a></li>
            <li><a class="dropdown-item text-danger" href="#">Block User</a></li>
          </ul>
        </div>
      </li>
      {{/each}}
    </ul>
    <!-- All Friends Section -->
    <h6 class="px-3 mt-3">All Friends</h6>
<ul class="list-group list-group-flush" id="all-friends">
  {{#if allFriends.length}}
    {{#each allFriends}}
    <li class="list-group-item friend d-flex align-items-center" data-user-id="{{this.id}}" data-user="{{this.name}}">
      <div class="position-relative me-2">
        <img src="{{this.profileIcon}}" class="rounded-circle" alt="Profile Icon" width="40" height="40">
      </div>
      <span class="ms-2">{{this.name}}</span>
      <div class="dropdown ms-auto">
        <button class="btn btn-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
          Actions
        </button>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="#">View Profile</a></li>
          <li><a class="dropdown-item" href="#">Add to Favorites</a></li>
          <li><a class="dropdown-item text-danger" href="#">Block User</a></li>
        </ul>
      </div>
    </li>
    {{/each}}
  {{else}}
    <li class="list-group-item">No friends to display.</li>
  {{/if}}
</ul>


  </div>
</div>


    <!-- Chat Area Section -->
    <div class="col-md-10 col-sm-12 chat-area">
    <div class="chat-header">
        <h5 id="chat-user-name">Chatting with: {{activeUser.name}}</h5>
        <p id="typing-status" class="text-muted small"> </p>
      </div>

      <div class="chat-body" id="chat-messages">
        <!-- Messages will be dynamically appended here -->
      </div>

      <div class="chat-footer">
      <div class="d-flex">
          <!-- Message Input -->
          <input
            type="text"
            id="message-input"
            class="form-control me-2"
            placeholder="Type a message..."
          />
          <!-- Emojis Button -->
          <button id="emoji-btn" class="btn btn-outline-secondary me-2" data-bs-toggle="tooltip" data-bs-placement="top" title="Add Emoji">
            <i class="bi bi-emoji-smile"></i>
          </button>
          <!-- File Upload Button -->
          <label for="file-input" class="btn btn-primary me-2" data-bs-toggle="tooltip" data-bs-placement="top" title="Add an Image">
            <i class="bi bi-cloud-upload"></i>  
          </label>
            <input type="file" id="file-input" class="d-none" accept="image/*" />
          <!-- Send Button -->
          <button id="send-btn" class="btn btn-primary" data-bs-toggle="tooltip" data-bs-placement="top" title="Send Message">Send</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const yourUserId = {{activeUser.id}}; // Pass the current user's ID to the client
</script>